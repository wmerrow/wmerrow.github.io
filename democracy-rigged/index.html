<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="utf-8">
      <title>American Democracy Is Rigged Against Democrats</title>
      <script type="text/javascript" src= "https://d3js.org/d3.v6.js"></script>
      <script type="text/javascript" src= "d3-simple-slider.js"></script>
      <link rel="stylesheet" href="styles.css">
  </head>
  <body>

    <section>
      <h1>American Democracy Is Rigged Against Democrats</h1>
      <div id="introBlurb">
        <div class="byline">
          <p class="bylineP">By Will Merrow</p>
          <p class="bylineP">INFO 697: Programming Interactive Data Vis</p>
          <p class="bylineP">Fall 2020</p>
        </div>
        <p>Republicans lost the popular vote but won the presidency in 2000 and 2016, and almost did it again in 2020. How is this possible? The answer is that Republicans have a <strong>built-in advantage</strong> in the rules of the electoral college. </p>
        <p>In fact, Republicans also have a built-in advantage in the House and the Senate, which are even harder for Democrats to win. This means that Republicans can lose the popular vote but still win the presidency, House, and Senate, while Democrats need a landslide popular vote victory to win all three.</p>
        <p>The graphics below show the outcome under different popular vote scenarios, imagining that states and districts vote according to whether they lean Democrat or Republican after including the popular vote scenario. For example, in a "D +3" scenario, Democrats would win a state like Pennsylvania which leans one point more Republican than the nation. For a detailed explanation, see the About the Data section.</p>
        <p>Use the slider to see how different scenarios lead to different outcomes, and read on to understand why Republicans have such a strong built-in advantage.</p>
      </div> 
      <div class="row">  
        <h4>Scenario</h4>
        <svg id="introSlider" class="vis sliderSvg"></svg>
      </div>
      <div class="row">
        <svg id="introPopResult" class="introVis introResult intro"></svg>
        <svg id="introPop" class="introVis barNonHouse intro bar"></svg>
      </div>
      <h5>&darr;</h5>
      <div id="introResults">
        <div class="row">
          <svg id="introPresResult" class="introVis introResult intro"></svg>
          <svg id="introPresChart" class="introVis barNonHouse intro bar"></svg>
        </div>
        <div class="row">
          <svg id="introHouseResult" class="introVis introResult intro"></svg>
          <svg id="introHouseChart" class="introVis barHouse intro bar"></svg>
        </div>
        <div class="row">
          <svg id="introSenateResult" class="introVis introResult intro"></svg>
          <svg id="introSenateChart" class="introVis barNonHouse intro bar"></svg>
        </div>
      </div>
    </section>

    <section>
      <h2>The Presidency</h2>
      <div class="explainer">
        <p>The Presidency is biased in favor of Republicans because of the electoral college, where states are <strong>winner-take-all</strong>. In each state, the losing party's votes are "wasted" - whether they lost in a landslide or a slim margin. Currently, there are more wasted Democratic votes than Republican votes. For example, in states like Florida and Texas, Democrats usually do well but not well enough to win.</p>
        <p>An additional reason for pro-Republican bias is that each state gets a number of electoral votes equal to the number of congressional districts <strong>plus two</strong>, favoring small states.</p>
        <p>The electoral college hasn't always favored Republicans, and could shift to favor Democrats in the future if demographic changes result in more wasted Republican votes in states like Florida and Texas.</p>
        <p>One solution to this problem is state-level initiatives like Maine and Nebraska have adopted - in these states, instead of a winner-take-all system, the winner of each congressional district gets one electoral vote, and the statewide winner gets two votes.</p>
      </div>
      <div class="panel" id="pres">
        <svg id="presSlider" class="vis sliderSvg"></svg>
        <div class="arrowContainer">
          <svg id="presPopResult" class="panelResult pres"></svg>
          <h5>&darr;</h5>
          <svg id="presPresResult" class="panelResult pres"></svg>
        </div>
        <svg id="presMap" class="vis pres map"></svg>
        <svg id="presChart" class="vis barNonHouse pres bar"></svg>
      </div>
    </section>

    <section>
      <h2>The House of Representatives</h2>
      <div class="explainer">
        <p>Republicans have an even larger advantage in the House - Democrats need to win the popular vote by five points just to win a majority. This is because each district is winner-take-all, and as with the presidency, there are more "wasted" Democratic votes than Republican votes.</p>
        <p>One reason for this is <strong>gerrymandering</strong>, where a party draws the district boundaries to favor itself. By packing the other party's voters into one district, a party can lose that district but win more districts overall. The other reason for this is the natural pattern of <strong>where Democrats and Republicans live</strong> - urban areas tend to be heavily Democratic.</p>
        <p>The solution to this would be for Democrats to win state legislatures and redraw the district boundaries, but this only happens every decade, and Democrats failed to win the needed state houses in 2020.</p>
      </div>
      <div class="panel" id="house">
        <svg id="houseSlider" class="vis sliderSvg"></svg>
        <div class="arrowContainer">
          <svg id="housePopResult" class="panelResult house"></svg>
          <h5>&darr;</h5>
          <svg id="houseHouseResult" class="panelResult house"></svg>
        </div>
        <svg id="houseMap" class="vis house map"></svg>
        <svg id="houseChart" class="vis barHouse house bar"></svg>
      </div>
    </section>
    
    <section>
      <h2>The Senate</h2>
      <div class="explainer">
        <p>Last but definitely not least, the Senate has an extreme structural bias towards Republicans, far more than the presidency or the House. In the Senate, <strong>each state has two senators regardless of population</strong>. This means a small population state like Wyoming has the same power as a large state like California. There are more Republican-leaning states than Democratic-leaning states, so the Republicans have an advantage.</p>
        <p>The advantage is enormous - Republicans can lose the popular vote by six points and still maintain control of the Senate. Having a filibuster-proof majority of 60 senators, as the Democrats did in 2008 when they passed Obamacare, is inconceivable in the near term.</p>
        <p>The only possible way for Democrats to even the playing field in the Senate is to create multiple new states that lean Democratic, for example, giving statehood to D.C. and Puerto Rico. But this would require - wait for it - control of the Senate.</p>
      </div>
      <div class="panel" id="senate">
        <svg id="senateSlider" class="vis sliderSvg"></svg>
        <div class="arrowContainer">
          <svg id="senatePopResult" class="panelResult senate"></svg>
          <h5>&darr;</h5>
          <svg id="senateSenateResult" class="panelResult senate"></svg>
        </div>
        <svg id="senateMap" class="vis senate map"></svg>
        <svg id="senateChart" class="vis barNonHouse senate bar"></svg>
      </div>
    </section>

    <section>
      <h2>About the Data</h2>
      <p>The scenarios presented here imagine that each state and district votes according to whether it leans Republican or Democrat after factoring in the popular vote scenario. Each state and district has a partisan lean, which is the difference between how it votes and how the country votes overall (in percentage points).</p>
      <p>For example, Pennsylvania’s partisan lean is +1 R, meaning it votes one percentage point more Republican than the national average. In an “Even” popular vote scenario, the national popular vote is tied (50% to 50%), and Republicans win the state of Pennsylvania by 1 percentage point (50.5% to 49.5%). In a "D +3" popular vote scenario, Democrats win the popular vote by 3 points (51.5% to 48.5%) and win Pennsylvania by 2 points (51% to 49%).</p>
      <p>In the event of a tie in a state or district, Democrats are assumed to win, in order to provide a more conservative estimate of the level of bias.</p>
      <p>In reality of course, which party wins a state or district also depends on the strength of the individual candidates, not just party identification. Additionally, elections for each office aren’t all held at the same time, and the presence of third party candidates also affects the outcome.</p>
      <p>The partisan lean dataset comes from FiveThirtyEight, and uses election results from recent elections to calculate each state and district's partisan lean. The dataset weighs more recent elections the most, but does not yet include data for the 2020 election.</p>
    </section>
        
    <script type="text/javascript">
    
    Promise.all([
      d3.csv("data/pres_data.csv"),
	    d3.csv("data/house_data.csv"),
	    d3.csv("data/senate_data.csv"),
      d3.csv("data/pop_data.csv")
	])
     .then(function(data) {

      const pres_data = data[0];
      const house_data = data[1];
      const senate_data = data[2];
      const pop_data = data[3];

      console.log(pres_data);
      console.log(house_data);
      console.log(senate_data);
      console.log(pop_data);


      // DIMENSIONS

      // squares

      const squareScale = 1.5

      const pres_square = {
        w: squareScale * 26,
        h: squareScale * 26
      };
      const house_square = {
        w: squareScale * 4,
        h: squareScale * 4
      };
      const senate_square = {
        w: squareScale * 6.5,
        h: squareScale * 6.5
      };

      // panels

      const panelWidth = 560;
      const margin = {
        top: 5,
        right: 10,
        bottom: 5,
        left: 10
      };
      const result = {
        w: panelWidth,
        h: 35
      };
      const map = {
        w: panelWidth,
        h: panelWidth * 0.61835245046 // height maintains map image aspect ratio
      };
      const bar = {
        w: panelWidth,
        h: panelWidth / 87 * 5 // sets height all bar charts so that house squares will be perfectly square (house grid is 87 by 5)
      };
      const sliderSize = {
        w: panelWidth * 0.75,
        h: 50
      };
      const sliderMargin = 15;


      // SCALES

      const red = '#cf2e23';
      const blue = '#1b67c4';
      const gray = '#666666';

      // color scale - red if leans republican, blue if leans democrat or tie
      const leanColor = d3.scaleThreshold()
        .domain([0]) // split at 0
        .range([red, blue]); // takes inverted rlean so that 0 translates to a Democrat win instead of Republican win, to be generous about level of bias

      // pres state size scale
      const presSize = d3.scaleSqrt()
      	.domain([0, d3.max(pres_data, d => +d.electors)])
      	.range([0, pres_square.w]);
      
      // slider min/max
      const voteMaxD = -8;
      const voteMaxR = 8;
      // slider increment
      const increment = 2;
      // array of integers for slider ticks
      const voteRange = [];
      for (var i = voteMaxD; i <= voteMaxR; i = i + increment) {
        voteRange.push(i);
      };


      // SLIDER

      // function to add slider
      function addSlider(section) {

        // concatenate the appropriate svg id
        const sliderSvg = '#' + section + 'Slider';


        // define the slider
        const slider = d3.sliderTop()
          .min(voteMaxD)
          .max(voteMaxR)
          .default(0)
          .step(.5) // step between selectable values
          .width(sliderSize.w - sliderMargin * 2)
          // custom slider symbol
          .handle(
            d3.symbol()
              .type(d3.symbolCircle)
              .size(150)()
            )
          .tickValues(voteRange)
          .tickPadding(-3)
          // remove minus signs and append +D or +R, or change to Even
          .tickFormat((function (v) {
              if (v == 0) {
                return 'Even';
              } else if (v < 0) {
                return 'D +' + Math.abs(v); 
              } else if (v > 0) {
                return 'R +' + Math.abs(v); 
              };
          }))
          .displayValue(false)
          // onchange, pass section and slider value to update function to update graphics
          .on('onchange', function (value) {
            update(section, value);
          });

        d3.select(sliderSvg)
          .attr('width', sliderSize.w)
          .attr('height', sliderSize.h)
          .append('g')
          .attr('transform', 'translate(' + sliderMargin + ',' + (sliderSize.h - 10) + ')')
          .call(slider);

        // add slider title
        // d3.select('#introSlider')
        //   .append('text')
        //   .attr('class', 'sliderTitle')
        //   .text('Scenario')
        //   .attr('transform', 'translate(' + (sliderWidth) / 2 + ', 21)');

      };

      // add sliders to each section
      addSlider('intro');
      addSlider('pres');
      addSlider('house');
      addSlider('senate');


      // SVG DIMENSIONS

      // intro result text
      d3.selectAll('.introResult')
        .attr('width', result.w + margin.left + margin.right)
        .attr('height', result.h);

      // panel result text
      d3.selectAll('.panelResult')
        .attr('width', result.w + margin.left + margin.right)
        .attr('height', result.h);

      // bar charts
      d3.selectAll('.bar')
        .attr('width', bar.w + margin.left + margin.right)
        .attr('height', bar.h + margin.top + margin.bottom);
      
      // maps
      d3.selectAll('.map')
        .attr('width', map.w + margin.left + margin.right)
        .attr('height', map.h + margin.top + margin.bottom);


      // MAPS

      // function for adding basemaps
      const basemap = function (svg) {
	      d3.select(svg).append("svg:image")
		    .attr("xlink:href", "media/us_map.svg")
		    .attr("width", map.w)
		    .attr("x", margin.left)
		    .attr("y",margin.top);
  		};

  	  // add basemaps
      basemap('#presMap');
  	  basemap('#houseMap');
  	  basemap('#senateMap');

      // leader lines for crowded areas on map

      // rhode island
      d3.selectAll('.map')
        .append('line')
        .attr('class', 'leaderLine')
        .attr('x1', (0.916) * map.w + margin.left)
        .attr('y1', (0.288) * map.h + margin.top)
        .attr('x2', (0.916 + 0.029) * map.w + margin.left)
        .attr('y2', (0.288 + 0.027) * map.h + margin.top);

      // connecticut
      d3.selectAll('.map')
        .append('line')
        .attr('class', 'leaderLine')
        .attr('x1', (0.895) * map.w + margin.left)
        .attr('y1', (0.300) * map.h + margin.top)
        .attr('x2', (0.895 + 0.029) * map.w + margin.left)
        .attr('y2', (0.300 + 0.027) * map.h + margin.top);

      // maryland
      d3.selectAll('.map')
        .append('line')
        .attr('class', 'leaderLine')
        .attr('x1', (0.855) * map.w + margin.left)
        .attr('y1', (0.430) * map.h + margin.top)
        .attr('x2', (0.855 + 0.029) * map.w + margin.left)
        .attr('y2', (0.430 + 0.027) * map.h + margin.top);


      // president squares
      d3.select('#presMap').selectAll('rect')
        .data(pres_data)
        .join('rect')
        // x and y position account for size of square in order to center square
        .attr('x', d=> (+d.state_x + +d.offset_x) * map.w + margin.left - presSize(+d.electors) / 2)
        .attr('y', d=> (+d.state_y + +d.offset_y) * map.h + margin.top - presSize(+d.electors) / 2)
        .attr('width', d=> presSize(+d.electors))
        .attr('height', d=> presSize(+d.electors))
        .attr('class', 'rect');

      // house squares
      d3.select('#houseMap').selectAll('rect')
        .data(house_data)
        .join('rect')
        // position squares for each state, using state coordinates and then using modulo to create columns, with column size determined by the square root of the total districts in state, resulting in roughly square grids
        .attr('x', (d, i)=> {return (+d.state_x + +d.offset_x) * map.w + margin.left + Math.floor((d.district_number - 1) / Math.ceil(Math.sqrt(d.state_total))) * house_square.w - Math.ceil(Math.sqrt(d.state_total)) * house_square.w / 2;})
        .attr('y', (d, i)=> {return (+d.state_y + +d.offset_y) * map.h + margin.top + ((d.district_number - 1) % Math.ceil(Math.sqrt(d.state_total))) * house_square.h - Math.ceil(Math.sqrt(d.state_total)) * house_square.h / 2;})
        .attr('width', house_square.w)
        .attr('height', house_square.h)
		    .attr('class', 'rect');	

      // senate squares
      d3.select('#senateMap').selectAll('rect')
        .data(senate_data)
        .join('rect')
        .attr('x', d=> +d.state_x * map.w + +d.offset_x * senate_square.w + margin.left)
        .attr('y', d=> +d.state_y * map.h + +d.offset_y * senate_square.h + margin.top)
        .attr('width', senate_square.w)
        .attr('height', senate_square.h)
        .attr('class', 'rect');




      // BAR CHARTS

      // pop charts

      // presPop = presPopSvg.selectAll('rect')
      //   .data(pop_data.sort((a,b)=>d3.ascending(+a.rlean, +b.rlean)))
      //   .join('rect')
      //   .attr('x', (d, i)=> i * bar.w / 400 + margin.left)
      //   .attr('y', margin.top)
      //   .attr('width', bar.w / 400)
      //   .attr('height', bar.h);

      // housePop = housePopSvg.selectAll('rect')
      //   .data(pop_data.sort((a,b)=>d3.ascending(+a.rlean, +b.rlean)))
      //   .join('rect')
      //   .attr('x', (d, i)=> i * bar.w / 400 + margin.left)
      //   .attr('y', margin.top)
      //   .attr('width', bar.w / 400)
      //   .attr('height', bar.h);

      // senatePop = senatePopSvg.selectAll('rect')
      //   .data(pop_data.sort((a,b)=>d3.ascending(+a.rlean, +b.rlean)))
      //   .join('rect')
      //   .attr('x', (d, i)=> i * bar.w / 400 + margin.left)
      //   .attr('y', margin.top)
      //   .attr('width', bar.w / 400)
      //   .attr('height', bar.h);


      // function for stacking data (for pres bar chart)
      const myStack = function (dataToStack) {
        const total = d3.sum(dataToStack, d => d.electors);
        let stackPosition = 0;
        return dataToStack.sort((a,b)=>d3.ascending(+a.rlean, +b.rlean))
          .map(d => ({
            state: d.state,
            rlean: d.rlean,
            electors: +d.electors,
            startPosition: stackPosition,
            endPosition: (stackPosition += +d.electors)
          }));
      };

      // function for charts on specified svg

      function drawPresBar(svg) {
        d3.select(svg).selectAll('rect')
        .data(myStack(pres_data)) // uses stacked data
        .join('rect')
        .attr('x', d=> d.startPosition / 538 * bar.w + margin.left)
        .attr('y', margin.top)
        .attr('width', d=> d.electors / 538 * bar.w)
        .attr('height', bar.h)
        //.attr('vector-effect', 'non-scaling-stroke')
        .attr('class', 'rect');
      };

      function drawHouseBar(svg) {
        d3.select(svg).selectAll('rect')
        .data(house_data.sort((a,b)=>d3.ascending(+a.rlean, +b.rlean)))
        .join('rect')
        // determine x and y, wrapping from one column to the next (wrap to next column after 5 squares)
        .attr('x', (d, i)=>{return Math.floor(i / 5) * bar.w / 87 + margin.left;}) // use math.floor to determine column
        .attr('y', (d, i)=>{return (i % 5) * bar.h / 5 + margin.top;}) // use modulo to determine row
        .attr('width', bar.w / 87)
        .attr('height', bar.h / 5)
        .attr('class', 'rect');
      };

      function drawSenateBar(svg) {
        d3.select(svg).selectAll('rect')
        .data(senate_data.sort((a,b)=>d3.ascending(+a.rlean, +b.rlean)))
        .join('rect')
        .attr('x', (d, i)=> i * bar.w / 100 + margin.left)
        .attr('y', margin.top)
        .attr('width', bar.w / 100)
        .attr('height', bar.h)
        .attr('class', 'rect');
      };

      function drawPopBar(svg) {
        d3.select(svg).selectAll('rect')
        .data(pop_data.sort((a,b)=>d3.ascending(+a.rlean, +b.rlean)))
        .join('rect')
        .attr('x', (d, i)=> i * bar.w / 400 + margin.left)
        .attr('y', margin.top)
        .attr('width', bar.w / 400 * 2) // double width so rects overlap and you don't see spaces in between
        .attr('height', bar.h);
      };

      // draw bar charts

      drawPopBar('#introPop');

      drawPresBar('#introPresChart');
      drawPresBar('#presChart');

      drawHouseBar('#introHouseChart');
      drawHouseBar('#houseChart');

      drawSenateBar('#introSenateChart');
      drawSenateBar('#senateChart');


      // majority lines (different style for non-house bars and house bars)

      const house_grid_square = bar.w / 87;

      d3.selectAll('.barNonHouse')
        .append('path')
        .attr('class', 'majorityLine')
        .attr('d', 'M ' + (margin.left + bar.w / 2) + ' 0' + ' V ' + (bar.h + margin.top + margin.bottom));

      d3.selectAll('.barHouse')
        .append('path')
        .attr('class', 'majorityLine')
        .attr('d', 'M ' + (margin.left + bar.w / 2 + house_grid_square / 2) + ' 0' + ' l 0 ' + (margin.top + house_grid_square * 2) + ' l ' + (house_grid_square * -1) + ' ' + (house_grid_square) + ' l 0 ' + (house_grid_square * 2 + margin.bottom)); //(bar.h + margin.top * 2 - 5))

      // d3.select('#introPop')
      //   .append('text')
      //   .attr('class', 'majorityLabel')
      //   .text('Majority')
      //   .attr('transform', 'translate(' + (bar.w / 2 + margin.left) + ', 10)');


      // intro results




      // function for adding winner messages and result numbers
      // type is what type of result (pop, pres, house, senate)
      function drawResult(type, svg) {
        d3.select(svg).append('text')
          .attr('class', 'winnerText ' + type + 'WinnerText')
          .attr('x', result.w / 2 + margin.left)
          .attr('y', 13)
          .style('fill', 'green') // gets populated by update function
          .text(''); // gets populated by update function
        d3.select(svg).append('text')
          .attr('class', 'resultText ' + type + 'ResultText')
          .attr('x', result.w / 2 + margin.left)
          .attr('y', 31)
          .style('fill', 'green') // gets populated by update function
          .text(''); // gets populated by update function
      };

      // draw results in intro section
      drawResult('pop', '#introPopResult');
      drawResult('pres', '#introPresResult');
      drawResult('house', '#introHouseResult');
      drawResult('senate', '#introSenateResult');

      // draw results in pres section
      drawResult('pop', '#presPopResult');
      drawResult('pres', '#presPresResult');

      // draw results in house section
      drawResult('pop', '#housePopResult');
      drawResult('house', '#houseHouseResult');

      // draw results in senate section
      drawResult('pop', '#senatePopResult');
      drawResult('senate', '#senateSenateResult');


      // UPDATE DATA

      // function for updating map/bar colors and result numbers (called by slider change)

      function update(section, vote) {
        // section is the section of the slider that was used (to just update charts in the appropriate section)
        // vote is the vote scenario selected in the slider

        // update colors of rects on bars and maps in the appropriate section
        d3.selectAll('.' + section + '.bar,.' + section + '.map').selectAll('rect')
          .style('fill', d => {
          return leanColor((+d.rlean + vote) * -1); // multiplying by -1 inverts to feed into leanColor (so that Democrats win ties)
        })

        // calculate Republicans' popular vote share, electoral college votes, house seats, and senate seats
        // assumes democrats win ties to be generous      

        const popResultR = d3.sum(pop_data, d => {if (+d.rlean + vote > 0) {return 1;}}) / 400; // 400 rows in popular vote data file
        const presResultR = d3.sum(pres_data, d => {if (+d.rlean + vote > 0) {return d.electors;}});
        const houseResultR = d3.sum(house_data, d => {if (+d.rlean + vote > 0) {return 1;}});        
        const senateResultR = d3.sum(senate_data, d => {if (+d.rlean + vote > 0) {return 1;}});
        
        // determine colors and text for winner/result messages

        let popWinnerColor, 
            popWinnerText, 
            popResultText, 
            presWinnerColor, 
            presWinnerText, 
            presResultText, 
            houseWinnerColor, 
            houseWinnerText, 
            houseResultText, 
            senateWinnerColor, 
            senateWinnerText, 
            senateResultText = '';

        // popular vote majority is >0.5
        if (popResultR > 0.5) {
          popWinnerColor = red;
          popWinnerText = 'Republicans win popular vote';
          popResultText = d3.format(".1%")(popResultR) + ' to ' + d3.format(".1%")(1 - popResultR);
        } else if (popResultR < 0.5) {
          popWinnerColor = blue;       
          popWinnerText = 'Democrats win popular vote';  
          popResultText = d3.format(".1%")(1 - popResultR) + ' to ' + d3.format(".1%")(popResultR);
        } else if (popResultR == 0.5) {
          popWinnerColor = gray;
          popWinnerText = 'Even popular vote';
          popResultText = d3.format(".1%")(1 - popResultR) + ' to ' + d3.format(".1%")(popResultR);
        };

        // presidency majority is >269
        if (presResultR > 269) {
          presWinnerColor = red;
          presWinnerText = 'Republicans win presidency';
          presResultText = (presResultR) + ' elec. votes to ' + (538 - presResultR) + ' elec. votes';
        } else if (presResultR < 269) {
          presWinnerColor = blue;       
          presWinnerText = 'Democrats win presidency';  
          presResultText = (538 - presResultR) + ' elec. votes to ' + (presResultR) + ' elec. votes';
        } else if (presResultR == 269) {
          presWinnerColor = gray;
          presWinnerText = 'Tie (states decide)';
          presResultText = (538 - presResultR) + ' elec. votes to ' + (presResultR) + ' elec. votes';
        };

        // house majority is >217
        if (houseResultR >= 218) {
          houseWinnerColor = red;
          houseWinnerText = 'Republicans win House';
          houseResultText = (houseResultR) + ' seats to ' + (435 - houseResultR) + ' seats';
        } else if (houseResultR < 218) {
          houseWinnerColor = blue;    
          houseWinnerText = 'Democrats win House';     
          houseResultText = (435 - houseResultR) + ' seats to ' + (houseResultR) + ' seats';
        };

        // senate majority is >50
        if (senateResultR > 50) {
          senateWinnerColor = red;
          senateWinnerText = 'Republicans win Senate';
          senateResultText = (senateResultR) + ' seats to ' + (100 - senateResultR) + ' seats';
        } else if (senateResultR < 50) {
          senateWinnerColor = blue;       
          senateWinnerText = 'Democrats win Senate';  
          senateResultText = (100 - senateResultR) + ' seats to ' + (senateResultR) + ' seats';
        } else if (senateResultR == 50) {
          senateWinnerColor = gray;
          senateWinnerText = 'Even (vice president breaks tie)';
          senateResultText = (100 - senateResultR) + ' seats to ' + (senateResultR) + ' seats';
        };

        // update text, numbers, and colors of all the result messages in each section (may select nothing depending on the section)

        d3.selectAll('.' + section).selectAll('.popWinnerText')
          .text(popWinnerText)
          .style('fill', popWinnerColor);
        d3.selectAll('.' + section).selectAll('.popResultText')
          .text(popResultText)
          .style('fill', popWinnerColor);

        d3.selectAll('.' + section).selectAll('.presWinnerText')
          .text(presWinnerText)
          .style('fill', presWinnerColor);
        d3.selectAll('.' + section).selectAll('.presResultText')
          .text(presResultText)
          .style('fill', presWinnerColor);

        d3.selectAll('.' + section).selectAll('.houseWinnerText')
          .text(houseWinnerText)
          .style('fill', houseWinnerColor);
        d3.selectAll('.' + section).selectAll('.houseResultText')
          .text(houseResultText)
          .style('fill', houseWinnerColor);

        d3.selectAll('.' + section).selectAll('.senateWinnerText')
          .text(senateWinnerText)
          .style('fill', senateWinnerColor);
        d3.selectAll('.' + section).selectAll('.senateResultText')
          .text(senateResultText)
          .style('fill', senateWinnerColor);

    	}; // end update function


      // initial results and colors (popular vote = 0)
      update('intro', 0);
      update('pres', 0);
      update('house', 0);
      update('senate', 0);


    })
        .catch(function(error){
          console.log(error);
    });

    </script>
  </body>
</html>